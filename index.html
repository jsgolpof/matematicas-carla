<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mates con Carla</title>
    <style>
        /* ESTILOS VISUALES (DISE√ëO) */
        :root {
            --primary: #FF6B6B; /* Rojo suave */
            --secondary: #4ECDC4; /* Turquesa */
            --accent: #FFE66D; /* Amarillo */
            --dark: #292f36;
            --light: #f7fff7;
            --font-main: 'Comic Sans MS', 'Chalkboard SE', sans-serif; /* Fuente amigable */
        }

        body {
            font-family: var(--font-main);
            background-color: var(--secondary);
            margin: 0;
            padding: 0;
            text-align: center;
            color: var(--dark);
            user-select: none; /* Evita que seleccione texto al tocar */
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
            background-color: var(--light);
            min-height: 100vh;
            box-shadow: 0 0 20px rgba(0,0,0,0.2);
        }

        h1 { color: var(--primary); font-size: 2.5rem; margin-bottom: 10px; }
        h2 { color: var(--dark); }

        /* BOTONES GRANDES PARA TABLET */
        button {
            background-color: var(--primary);
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 1.5rem;
            border-radius: 15px;
            margin: 10px;
            cursor: pointer;
            font-family: var(--font-main);
            box-shadow: 0 5px 0 #c0392b;
            transition: transform 0.1s;
            width: 80%;
            max-width: 400px;
        }

        button:active {
            transform: translateY(4px);
            box-shadow: 0 1px 0 #c0392b;
        }

        button.secondary { background-color: var(--secondary); box-shadow: 0 5px 0 #16a085; }
        button.accent { background-color: var(--accent); color: var(--dark); box-shadow: 0 5px 0 #f1c40f; }

        /* PANTALLAS */
        .screen { display: none; }
        .active { display: block; animation: fadeIn 0.5s; }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* ZONA DE EJERCICIO */
        .exercise-box {
            background: #eee;
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
            font-size: 3rem;
            font-weight: bold;
        }

        input[type="number"] {
            font-size: 2.5rem;
            padding: 10px;
            width: 150px;
            text-align: center;
            border: 3px solid var(--primary);
            border-radius: 10px;
            font-family: var(--font-main);
        }

        /* BARRA DE PROGRESO Y ESTRELLAS */
        .stats-bar {
            display: flex;
            justify-content: space-around;
            background: var(--dark);
            color: white;
            padding: 10px;
            border-radius: 10px;
            margin-bottom: 20px;
            font-size: 1.2rem;
        }

        .medal-area {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px;
            margin-top: 20px;
        }
        .medal { font-size: 3rem; filter: grayscale(100%); opacity: 0.5; transition: 0.5s; }
        .medal.unlocked { filter: grayscale(0%); opacity: 1; transform: scale(1.2); }

        /* MENSAJE DE VOZ */
        .voice-bubble {
            background: #e1f5fe;
            border: 2px solid #4fc3f7;
            padding: 15px;
            border-radius: 15px;
            margin-bottom: 15px;
            font-size: 1.2rem;
            position: relative;
        }
        .voice-icon { font-size: 2rem; cursor: pointer; }

    </style>
</head>
<body>

<div class="container">
    
    <!-- PANTALLA 1: INICIO -->
    <div id="screen-home" class="screen active">
        <h1>¬°Hola Carla! üåü</h1>
        <p>¬øQu√© quieres aprender hoy?</p>
        
        <div class="stats-bar">
            <span>‚≠ê <span id="total-stars">0</span></span>
            <span>üèÜ Nivel: <span id="user-level">Novata</span></span>
        </div>

        <button onclick="showScreen('screen-menu')">üìö Empezar a Jugar</button>
        <button class="secondary" onclick="showScreen('screen-rewards')">üèÖ Mis Medallas</button>
        <button class="accent" onclick="resetProgress()">‚ö†Ô∏è Borrar Progreso</button>
    </div>

    <!-- PANTALLA 2: MEN√ö DE TEMAS -->
    <div id="screen-menu" class="screen">
        <h2>Elige un tema</h2>
        <button onclick="startTopic('sumas')">‚ûï Sumas Divertidas</button>
        <button onclick="startTopic('restas')">‚ûñ Restas M√°gicas</button>
        <button onclick="startTopic('multiplicar')">‚úñÔ∏è Tablas de Multiplicar</button>
        <button onclick="startTopic('problemas')">üß† Problemas de L√≥gica</button>
        <button class="secondary" onclick="showScreen('screen-home')">üè† Volver al Inicio</button>
    </div>

    <!-- PANTALLA 3: ZONA DE EJERCICIOS -->
    <div id="screen-game" class="screen">
        <div class="voice-bubble">
            <span class="voice-icon" onclick="speakCurrentText()">üîä</span>
            <span id="voice-text">¬°Vamos all√°!</span>
        </div>

        <div class="exercise-box" id="question-display">
            2 + 2 = ?
        </div>

        <input type="number" id="answer-input" placeholder="?" inputmode="numeric">
        <br><br>
        <button onclick="checkAnswer()">‚úÖ Comprobar</button>
        <button class="secondary" onclick="showScreen('screen-menu')">üîô Salir</button>
    </div>

    <!-- PANTALLA 4: RECOMPENSAS -->
    <div id="screen-rewards" class="screen">
        <h2>Tu Colecci√≥n</h2>
        <p>Consigue estrellas para desbloquear medallas.</p>
        <div class="medal-area">
            <div id="medal-1" class="medal">ü•â</div>
            <div id="medal-2" class="medal">ü•à</div>
            <div id="medal-3" class="medal">ü•á</div>
            <div id="medal-4" class="medal">üëë</div>
            <div id="medal-5" class="medal">üöÄ</div>
        </div>
        <br>
        <button class="secondary" onclick="showScreen('screen-home')">üè† Volver</button>
    </div>

</div>

<script>
    /* L√ìGICA DE LA APLICACI√ìN (EL CEREBRO) */

    // ESTADO DEL JUEGO
    let currentTopic = '';
    let currentQuestion = {};
    let stars = parseInt(localStorage.getItem('carla_stars')) || 0;
    updateStats();

    // INICIALIZACI√ìN
    window.onload = function() {
        speak("Bienvenida Carla. ¬øQu√© quieres aprender hoy?");
        checkMedals();
    };

    // NAVEGACI√ìN
    function showScreen(screenId) {
        document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
        document.getElementById(screenId).classList.add('active');
        
        // Limpiar input al cambiar
        if(screenId === 'screen-game') {
            document.getElementById('answer-input').value = '';
            document.getElementById('answer-input').focus();
        }
    }

    // SISTEMA DE VOZ (TEXT TO SPEECH)
    function speak(text) {
        if ('speechSynthesis' in window) {
            // Cancelar cualquier audio anterior
            window.speechSynthesis.cancel();
            
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = 'es-ES'; // Espa√±ol
            utterance.rate = 0.9; // Un poco m√°s lento para ni√±os
            utterance.pitch = 1.1; // Un poco m√°s agudo (amigable)
            window.speechSynthesis.speak(utterance);
            
            document.getElementById('voice-text').innerText = text;
        }
    }

    function speakCurrentText() {
        speak(document.getElementById('voice-text').innerText);
    }

    // GENERADOR DE EJERCICIOS (INFINITOS)
    function startTopic(topic) {
        currentTopic = topic;
        showScreen('screen-game');
        generateQuestion();
    }

    function generateQuestion() {
        let num1, num2, answer, text, display;

        // L√≥gica seg√∫n el tema (Dificultad progresiva simple)
        if (currentTopic === 'sumas') {
            num1 = Math.floor(Math.random() * 500) + 10;
            num2 = Math.floor(Math.random() * 400) + 10;
            answer = num1 + num2;
            display = `${num1} + ${num2} = ?`;
            text = `Cu√°nto es ${num1} m√°s ${num2}`;
        } 
        else if (currentTopic === 'restas') {
            num1 = Math.floor(Math.random() * 500) + 50;
            num2 = Math.floor(Math.random() * (num1 - 10)) + 1; // Asegurar que el resultado sea positivo
            answer = num1 - num2;
            display = `${num1} - ${num2} = ?`;
            text = `Cu√°nto es ${num1} menos ${num2}`;
        }
        else if (currentTopic === 'multiplicar') {
            num1 = Math.floor(Math.random() * 9) + 2; // Tablas del 2 al 10
            num2 = Math.floor(Math.random() * 10) + 1;
            answer = num1 * num2;
            display = `${num1} x ${num2} = ?`;
            text = `Cu√°nto es ${num1} por ${num2}`;
        }
        else if (currentTopic === 'problemas') {
            // Problemas simples generados aleatoriamente
            const scenarios = [
                { t: "Tengo {n1} manzanas y compro {n2} m√°s. ¬øCu√°ntas tengo?", op: '+' },
                { t: "En una caja hay {n1} juguetes. Regalo {n2}. ¬øCu√°ntos quedan?", op: '-' },
                { t: "Carla tiene {n1} euros. Su abuela le da {n2}. ¬øCu√°nto tiene ahora?", op: '+' }
            ];
            const scenario = scenarios[Math.floor(Math.random() * scenarios.length)];
            num1 = Math.floor(Math.random() * 20) + 5;
            num2 = Math.floor(Math.random() * 10) + 1;
            
            if(scenario.op === '+') answer = num1 + num2;
            else answer = num1 - num2;

            display = scenario.t.replace('{n1}', num1).replace('{n2}', num2);
            text = display.replace('?', ''); // La voz lee el texto sin la interrogaci√≥n final para fluidez
        }

        currentQuestion = { answer: answer };
        document.getElementById('question-display').innerText = display;
        speak(text);
    }

    // COMPROBAR RESPUESTA
    function checkAnswer() {
        const userVal = parseInt(document.getElementById('answer-input').value);
        
        if (userVal === currentQuestion.answer) {
            // CORRECTO
            speak("¬°Muy bien Carla! Eres genial.");
            addStar();
            setTimeout(generateQuestion, 2000); // Espera 2 seg y pone otro
        } else {
            // INCORRECTO
            speak("Int√©ntalo de nuevo, t√∫ puedes.");
            document.getElementById('answer-input').value = '';
            document.getElementById('answer-input').focus();
        }
    }

    // SISTEMA DE PROGRESO Y MEDALLAS
    function addStar() {
        stars++;
        localStorage.setItem('carla_stars', stars);
        updateStats();
        checkMedals();
        
        // Efecto visual simple (cambio de color fondo moment√°neo)
        document.body.style.backgroundColor = "#ffeaa7";
        setTimeout(() => { document.body.style.backgroundColor = "var(--secondary)"; }, 300);
    }

    function updateStats() {
        document.getElementById('total-stars').innerText = stars;
        
        let level = "Novata";
        if(stars > 10) level = "Aprendiz";
        if(stars > 50) level = "Experta";
        if(stars > 100) level = "Maestra";
        if(stars > 500) level = "Genio Matem√°tico";
        
        document.getElementById('user-level').innerText = level;
    }

    function checkMedals() {
        // Desbloquear medallas seg√∫n estrellas
        if(stars >= 10) document.getElementById('medal-1').classList.add('unlocked');
        if(stars >= 50) document.getElementById('medal-2').classList.add('unlocked');
        if(stars >= 100) document.getElementById('medal-3').classList.add('unlocked');
        if(stars >= 300) document.getElementById('medal-4').classList.add('unlocked');
        if(stars >= 1000) document.getElementById('medal-5').classList.add('unlocked');
    }

    function resetProgress() {
        if(confirm("¬øSeguro que quieres borrar todas las estrellas?")) {
            stars = 0;
            localStorage.setItem('carla_stars', 0);
            updateStats();
            checkMedals();
            alert("Progreso borrado.");
        }
    }

    // Permitir usar la tecla "Enter" en la tablet si conecta teclado
    document.getElementById("answer-input").addEventListener("keypress", function(event) {
        if (event.key === "Enter") {
            checkAnswer();
        }
    });

</script>

</body>
</html>
